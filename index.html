<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="theme-color" content="#f97316">
  <title>Pragati Tai Bawankar (Shiv Sena) â€” Voter Search</title>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <style>
    :root{
      /* ORANGE THEME */
      --bg: #fff7ed;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      
      --accent: #f97316; 
      --accent-dark: #ea580c;
      --accent-soft: rgba(249, 115, 22, 0.1);
      
      --border: #fed7aa;
      --shadow: 0 4px 6px -1px rgba(249, 115, 22, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 12px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      min-height: 100vh;
    }
    .container{max-width:1280px; margin:0 auto}

    /* HERO SECTION */
    .hero{
      display: flex; gap: 20px; align-items: center;
      padding: 24px; border-radius: var(--radius);
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color: white; 
      box-shadow: var(--shadow);
      margin-bottom: 24px; border: 1px solid var(--border);
    }
    .photo{
      width: 90px; height: 90px; border-radius: 50%;
      overflow: hidden; flex-shrink: 0; border: 3px solid #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2); background: white;
    }
    .photo img{width:100%; height:100%; object-fit:cover}

    .heading{flex-grow: 1;}
    .heading h1{margin: 0; font-size: 22px; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.1);}
    .heading p{margin: 6px 0 0 0; color: rgba(255, 255, 255, 0.9); font-size: 15px;}

    .agency-branding {
      font-size: 16px; font-weight: 700; color: rgba(255, 255, 255, 0.95);
      text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;
      border-left: 1px solid rgba(255,255,255,0.3); padding-left: 20px;
    }

    .tag{
      display: inline-block; vertical-align: middle;
      padding: 4px 12px; border-radius: 20px;
      background: white; color: var(--accent-dark);
      font-weight: 700; font-size: 12px; margin-left: 10px; 
    }

    /* CONTROLS */
    .controls{display:flex; gap:16px; margin-bottom:20px; flex-wrap:wrap; align-items:center}
    .search-wrap{flex:1; position:relative; min-width:280px;}
    .search-wrap input{
      width:100%; padding:12px 12px 12px 42px;
      border-radius:10px; border:1px solid var(--border);
      font-size:16px; outline:none; background: var(--card);
    }
    .search-wrap input:focus{border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-soft);}
    .search-icon{position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--muted); opacity:0.7;}
    .clear-btn{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      background:none; border:none; cursor:pointer; color:var(--muted); font-size:18px; padding:4px; display:none; 
    }

    /* TABLE STYLES */
    .table-container{
      background:var(--card); border-radius:var(--radius);
      box-shadow:var(--shadow); overflow-x:auto; 
      border:1px solid var(--border);
    }
    table{width:100%; border-collapse:collapse; font-size:14px; min-width: 900px;}
    thead{background: #fff7ed; border-bottom:1px solid var(--border)}
    th{text-align:left; padding:14px; font-weight:600; color:#475569; white-space:nowrap}
    th button{border:none; background:none; cursor:pointer; font-weight:bold; color:var(--muted)}
    
    td{padding:12px 14px; border-bottom:1px solid #fff1f2; color:#334155; vertical-align: top;}
    
    /* Address column wrap */
    td:last-child {
      white-space: normal;
      min-width: 250px;
      line-height: 1.5;
    }

    tr:hover td{background:#fff7ed}
    .highlight{background:#ffedd5; color:#c2410c; font-weight:600; padding:0 2px; border-radius:2px}

    /* MOBILE CARDS */
    .mobile-cards{display:none; gap:16px}
    .m-card{
      background:var(--card); border-radius:10px;
      border:1px solid var(--border); box-shadow:0 1px 3px rgba(0,0,0,0.05);
      padding: 16px; /* Added padding here */
    }
    .m-row{margin-bottom:8px; display:flex; justify-content:space-between; border-bottom:1px solid #f1f5f9; padding-bottom:8px; flex-wrap: wrap;}
    .m-label{font-weight:600; font-size:13px; color:var(--muted); width: 100%; margin-bottom: 2px;}
    .m-val{font-size:14px; color: #334155; width: 100%;}

    @media (max-width: 900px){
      table{display:none}
      .mobile-cards{display:grid; grid-template-columns:1fr;}
      .hero{flex-direction:column; text-align:center;}
      .agency-branding {
        border-left: none; border-top: 1px solid rgba(255,255,255,0.3);
        padding-left: 0; padding-top: 10px; margin-top: 10px; width: 100%;
      }
    }

    /* PAGER */
    .pager{
      padding:16px; display:flex; gap:6px; justify-content:center; align-items:center;
      background: #fff7ed; border-top:1px solid var(--border);
    }
    .page-btn{
      border:1px solid var(--border); background:white;
      padding:8px 14px; border-radius:6px; cursor:pointer; color:#475569;
    }
    .page-btn.active{background:var(--accent); color:white; border-color:var(--accent)}

    #statusMsg{text-align:center; padding:40px; color:var(--muted); font-style:italic}
    footer{text-align:center; margin-top:30px; font-size:13px; color:#94a3b8}
  </style>
</head>
<body>

<div class="container">
  <div class="hero">
    <div class="photo">
      <img src="https://raw.githubusercontent.com/PRAGATIBAWANKAR1/Pragati-Tai-Bawankar/main/WhatsApp%20Image%202025-11-27%20at%205.00.54%20AM.jpeg" alt="Pragati Tai">
    </div>
    <div class="heading">
      <h1>Pragati Tai Bawankar <span class="tag">Shiv Sena</span></h1>
      <p>Official Voter Search Portal</p>
    </div>
    <div class="agency-branding">The SM Production</div>
  </div>

  <div class="controls">
    <div class="search-wrap">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input id="q" type="text" placeholder="Search by Name, EPIC, Ward, Address..." autocomplete="off">
      <button id="clearBtn" class="clear-btn">âœ•</button>
    </div>
    <div class="meta-counts">Showing <strong id="showCount">0</strong> of <strong id="totalCount">0</strong> records</div>
  </div>

  <div class="table-container">
    <div id="statusMsg">Loading database...</div>
    <table id="dataTable">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
    <div id="cards" class="mobile-cards"></div>
    <div id="pager" class="pager" style="display:none"></div>
  </div>

  <footer>Data sourced from GitHub â€¢ The SM Production</footer>
</div>

<script>
/* CONFIG */
const CSV_URL = "https://raw.githubusercontent.com/PRAGATIBAWANKAR1/Pragati-Tai-Bawankar/main/VOTERLISTALL8.csv";
const PAGE_SIZE = 25;
const COLUMNS_TO_SHOW = 12; // Sufficient limit to show all columns

/* STATE */
let rawData=[], filteredData=[], headers=[], currentPage=1, sortCol='', sortAsc=true;

function init(){
  Papa.parse(CSV_URL, {
    download: true, header: true, skipEmptyLines: true, worker: true,
    complete: function(results) {
      if(results.data && results.data.length > 0){
        
        // --- ðŸ”‘ CRITICAL FIX: Clean up headers and data keys for proper mapping ---
        headers = (results.meta.fields || Object.keys(results.data[0] || {})).map(h => h.trim());
        rawData = results.data.map(row => {
            const cleanRow = {};
            // Re-map row data using cleaned headers
            Object.keys(row).forEach(key => {
                cleanRow[key.trim()] = (row[key] || '').toString().trim();
            });
            return cleanRow;
        }).filter(r => Object.values(r).some(v => v));
        // --------------------------------------------------------------------------
        
        filteredData = [...rawData];
        setupTableHeaders();
        updateUI(true);
      } else {
        document.getElementById('statusMsg').textContent = "No data found.";
      }
    },
    error: (err) => document.getElementById('statusMsg').textContent = "Error loading data."
  });
}

function updateUI(resetPage = false){
  if(resetPage) currentPage = 1;
  const total = filteredData.length;
  document.getElementById('totalCount').textContent = rawData.length.toLocaleString();
  document.getElementById('showCount').textContent = total.toLocaleString();

  if(total === 0){
    document.getElementById('statusMsg').style.display = 'block';
    document.getElementById('statusMsg').textContent = "No records found.";
    document.getElementById('dataTable').style.display = 'none';
    document.getElementById('cards').style.display = 'none';
    document.getElementById('pager').style.display = 'none';
    return;
  }

  document.getElementById('statusMsg').style.display = 'none';
  document.getElementById('dataTable').style.display = 'table';
  document.getElementById('cards').style.display = (window.innerWidth <= 900) ? 'grid' : 'none';
  document.getElementById('pager').style.display = 'flex';

  const start = (currentPage - 1) * PAGE_SIZE;
  const end = start + PAGE_SIZE;
  const pageData = filteredData.slice(start, end);

  renderTable(pageData);
  renderCards(pageData);
  renderPager(total);
}

function renderTable(rows){
  const tbody = document.getElementById('tbody'); tbody.innerHTML = '';
  const displayCols = headers.slice(0, COLUMNS_TO_SHOW);

  rows.forEach(row => {
    const tr = document.createElement('tr');
    displayCols.forEach(col => {
      const td = document.createElement('td');
      td.innerHTML = highlightText(row[col] || '');
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function renderCards(rows){
  const container = document.getElementById('cards'); container.innerHTML = '';
  const displayCols = headers.slice(0, COLUMNS_TO_SHOW);

  rows.forEach(row => {
    const card = document.createElement('div'); card.className = 'm-card';
    let html = '';
    displayCols.forEach(col => {
      // For mobile view, address column will wrap naturally
      html += `<div class="m-row"><span class="m-label">${escapeHtml(col)}</span><span class="m-val">${highlightText(row[col] || '')}</span></div>`;
    });
    card.innerHTML = html;
    container.appendChild(card);
  });
}

function setupTableHeaders(){
  const thead = document.getElementById('thead'); thead.innerHTML = '';
  const tr = document.createElement('tr');
  headers.slice(0, COLUMNS_TO_SHOW).forEach(col => {
    const th = document.createElement('th');
    th.innerHTML = `${escapeHtml(col)} <button onclick="sortData('${escapeHtml(col)}')">â‡…</button>`;
    tr.appendChild(th);
  });
  thead.appendChild(tr);
}

function highlightText(text){
  const term = document.getElementById('q').value.trim();
  if(!term || !text) return escapeHtml(text);
  const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
  return escapeHtml(text).replace(regex, '<span class="highlight">$1</span>');
}

function filterData(){
  const term = document.getElementById('q').value.toLowerCase().trim();
  document.getElementById('clearBtn').style.display = term ? 'block' : 'none';
  if(!term) filteredData = [...rawData];
  else filteredData = rawData.filter(r => {
      // Search across all available headers
      return headers.slice(0, COLUMNS_TO_SHOW).some(h => String(r[h] || '').toLowerCase().includes(term));
  });
  updateUI(true);
}

function sortData(col){
  if(sortCol === col) sortAsc = !sortAsc;
  else { sortCol = col; sortAsc = true; }
  filteredData.sort((a,b) => {
    const A = (a[col]||'').toLowerCase(), B = (b[col]||'').toLowerCase();
    return (A<B ? -1 : 1) * (sortAsc ? 1 : -1);
  });
  updateUI(true);
}

function renderPager(total){
  const totalPages = Math.ceil(total / PAGE_SIZE);
  const pager = document.getElementById('pager'); pager.innerHTML = '';
  if(totalPages <= 1) return;
  const btn = (t, p, d) => {
    const b = document.createElement('button'); b.className = `page-btn ${p===currentPage?'active':''}`;
    b.textContent = t; b.disabled = d; b.onclick = () => { currentPage = p; updateUI(); window.scrollTo(0,0); };
    pager.appendChild(b);
  };
  btn('Prev', currentPage-1, currentPage===1);
  let start = Math.max(1, currentPage-2), end = Math.min(totalPages, start+4);
  for(let i=start; i<=end; i++) btn(i, i, false);
  btn('Next', currentPage+1, currentPage===totalPages);
}

function escapeHtml(s){ return String(s||'').replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

let tOut;
document.getElementById('q').addEventListener('input', () => { clearTimeout(tOut); tOut=setTimeout(filterData, 300); });
document.getElementById('clearBtn').addEventListener('click', () => { document.getElementById('q').value=''; filterData(); });
window.addEventListener('resize', () => { updateUI(); });

init();
</script>
</body>
</html>
